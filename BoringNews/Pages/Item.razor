@page "/Item/{ItemId:int}"

@if (FeedItem is null)
{
    <h3>Loading...</h3>
}
else
{
    <MudText Typo="Typo.h4">
        <a href="@FeedItem.url" target="_blank">@FeedItem.title</a>
    </MudText>
    <MudText Typo="Typo.subtitle1">Submitted at @FeedItem.time.ToLocalDateTime(); by @FeedItem.by</MudText>
    <MudText Typo="Typo.subtitle2">@FeedItem.score points</MudText>
    
    <MudDivider Class="my-6" />
                        
    @foreach (var comment in Comments)
    {
        <Comment FeedItem="@comment" />
    }
}


@code {

    [Parameter] public int ItemId { get; set; }

    [Inject] public HackerNewsApiService ApiService { get; set; } = null!;

    public FeedItem? FeedItem { get; set; }
    public IEnumerable<FeedItem> Comments { get; set; } = new List<FeedItem>();

    protected override async Task OnParametersSetAsync()
    {
        FeedItem = await ApiService.GetFeedItemDetails(ItemId);

        if (FeedItem.kids != null && FeedItem.kids.Any())
        {
            Comments = await ApiService.GetFeedItemDetails(FeedItem.kids);
        }
    }

}